<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Captchetat POC A11Y</title>
  <link rel="stylesheet" href="/design-system/dsfr.main.css"/>
  <style>
    body {
      font-family: sans-serif;
    }

    main {
      margin: auto;
      width: 526px;
    }
  </style>
</head>
<body>
<main>
  <form class="fr-py-5w" action="/users/sign_in" accept-charset="UTF-8" method="post">
    <h1 class="fr-h1">Inscription</h1>

    <fieldset aria-labelledby="new-account-legend" class="fr-mb-0 fr-fieldset">
      <div class="fr-fieldset__element">
        <p class="fr-text--sm">
          Les champs suivis d’un astérisque (<img src="/mandatory-icon.svg" alt="obligatoire"/>) sont obligatoires.
        </p>
      </div>
      <div class="fr-fieldset__element">
        <div class="fr-input-group" data-controller="email-input" data-email-input-url-value="/check_email">
          <label class="fr-label" for="user_email">
            Adresse électronique <img src="/mandatory-icon.svg" alt="obligatoire"/>
            <span class="fr-hint-text">Format attendu : adresse@mail.com</span>
          </label>
          <input autocomplete="email" autofocus="autofocus" class="fr-input fr-mb-0" required="required"
                 data-action="blur->email-input#checkEmail" data-email-input-target="input" data-controller=""
                 type="email" value="" name="user[email]" id="user_email">
        </div>
      </div>
      <div class="fr-fieldset__element">
        <div class="fr-input-group fr-password" data-fr-js-password="true">
          <label class="fr-label fr-password__label"
                 for="user_password"
                 data-fr-js-password-label="true"
                 style="padding-right: 6rem;">
            Mot de passe
            <img src="/mandatory-icon.svg" alt="obligatoire"/>
          </label>
          <input autocomplete="current-password" data-email-input-target="next"
                 class="fr-password__input fr-input fr-mb-0" required="required" data-controller=""
                 type="password" name="user[password]" id="user_password" data-fr-js-password-input="true">
        </div>
      </div>

      <button type="button" id="switch-mode-button" class="fr-btn">Changer de mode</button>

      <div class="fr-fieldset__element" id="captcha-image">
        <label class="fr-label">
          Reproduire la suite de caractères
          <img src="/mandatory-icon.svg" alt="obligatoire"/>
        </label>
        <audio id="audio-captcha" src="/captcha-example.mp3" loop></audio>
        <img src="captcha-example.png" alt="Exemple de CAPTCHA">
        <button id="audio-button" type="button" aria-label="Lire du code du captcha">
          <img src="/icons/play.png" id="audio-button-image" alt="" width="24">
        </button>

        <button type="button" aria-label="Recharger le captcha">
          <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 17 20" fill="none"
               id="iconReload">
            <path
                d="M9.00003 4.0001C11.1 4.0001 13.1 4.8001 14.6 6.3001C17.7 9.4001 17.7 14.5001 14.6 17.6001C12.8 19.5001 10.3 20.2001 7.90003 19.9001L8.40003 17.9001C10.1 18.1001 11.9 17.5001 13.2 16.2001C15.5 13.9001 15.5 10.1001 13.2 7.7001C12.1 6.6001 10.5 6.0001 9.00003 6.0001V10.6001L4.00003 5.6001L9.00003 0.600098V4.0001ZM3.30003 17.6001C0.700029 15.0001 0.300029 11.0001 2.10003 7.9001L3.60003 9.4001C2.50003 11.6001 2.90003 14.4001 4.80003 16.2001C5.30003 16.7001 5.90003 17.1001 6.60003 17.4001L6.00003 19.4001C5.00003 19.0001 4.10003 18.4001 3.30003 17.6001V17.6001Z"
                fill="black"></path>
          </svg>
        </button>
        <div class="fr-mb-1w">
          <input class="fr-input" type="text" aria-label="Saisir le captcha"
                 placeholder="Saisir le captcha"/>
        </div>
      </div>

      <div class="fr-fieldset__element" id="captcha-question">
        <label class="fr-label" for="captcha-question-input">
          En quel est saison est le mois d'avril ?
          <img src="/mandatory-icon.svg" alt="obligatoire"/>
        </label>
        <div class="fr-mb-1w">
          <input class="fr-input" type="text" id="captcha-question-input"/>
        </div>
      </div>

      <div class="fr-fieldset__element">
        <div class="fr-btns-group"><input type="submit" name="commit" value="Se connecter" class="fr-btn"
                                          data-disable-with="Se connecter"></div>
      </div>
    </fieldset>
  </form>
</main>

<script type="module" href="/design-system/dsfr.module.min.js"></script>
<script type="text/javascript" nomodule href="/design-system/dsfr.nomodule.min.js"></script>

<script>

  function switchToImageMode() {
    const captchaImage = document.getElementById('captcha-image');
    const captchaQuestion = document.getElementById('captcha-question');
    captchaImage.style.display = "block";
    captchaQuestion.style.display = "none";
  }

  function switchToQuestionMode() {
    const captchaImage = document.getElementById('captcha-image');
    const captchaQuestion = document.getElementById('captcha-question');
    captchaImage.style.display = "none";
    captchaQuestion.style.display = "block";
  }

  document.addEventListener('DOMContentLoaded', () => {
    let captchaMode = "image";

    switchToImageMode();
    const switchModeButton = document.getElementById('switch-mode-button');
    switchModeButton.addEventListener('click', () => {
      if (captchaMode === "question") {
        switchToImageMode();
        captchaMode = "image";
      } else {
        switchToQuestionMode();
        captchaMode = "question";
      }
    });

    const audio = document.getElementById('audio-captcha');
    const audioButton = document.getElementById('audio-button');
    const audioButtonImage = document.getElementById('audio-button-image');
    let audioPlaying = false;

    audioButton.addEventListener('click', () => {
      if (audioPlaying) {
        audio.pause();
        audioPlaying = false;
        audioButton.setAttribute("aria-label", "Mettre en pause la lecture");
        audioButtonImage.src = '/icons/play.png';
      } else {
        audio.play();
        audioPlaying = true;
        audioButton.setAttribute("aria-label", "Lire le code du captcha");
        audioButtonImage.src = '/icons/pause.png';
      }
    });
  });

</script>

</body>
</html>
